<!DOCTYPE html>
<meta charset="utf-8">
<!-- 
Melnet.html: a tool for visualising GTFS data

License: CC0
Original Author: Jonathan Newnham
-->
<style>
</style>
<title>Melnet</title>
<body>
<div id="errors"></div>
<div id="main">
  <svg id="chart" width="800" height="800">
    
  </svg>
</div>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

var width = 800;
var height = 800;

var x = d3.scaleLinear();
var y = d3.scaleLinear();

var stops = [];
var timings = [];

function init() {
	loadstops();
}

function loadstops() {
  d3.csv("gtfs/2/stops.txt", function(error, csv_rows) {
    if (error)
      document.getElementById("errors").innerHTML = "Couldn't load " + datafile + ": " + error.statusText;
    else
      load_rows(csv_rows);
  });
}

function load_rows(csv_rows) {
  document.getElementById("errors").innerHTML = "";
  stops = csv_rows.map(function(row) {
    return {
      stop_id: row.stop_id,
      stop_name: row.stop_name,
      stop_lat: parseFloat(row.stop_lat),
      stop_lon: parseFloat(row.stop_lon),
    };
  });

  layout();
}

function layout() {
  var miny = d3.min(stops.map(d=>d.stop_lat));
  var maxy = d3.max(stops.map(d=>d.stop_lat));
  var minx = d3.min(stops.map(d=>d.stop_lon));
  var maxx = d3.max(stops.map(d=>d.stop_lon));
  x = d3.scaleLinear()
    .domain([minx, maxx])
    .range([0, width]);
  y = d3.scaleLinear()
    .domain([miny, maxy])
    .range([0, height]);

  update();
}

function update() {
  var sel = d3.select("svg").selectAll("circle").data(stops);
  sel
    .enter()
    .append("circle")
      .style("stroke", "black")
      .style("fill", "grey")
      .attr("cx", d=>x(d.stop_lon))
      .attr("cy", d=>y(d.stop_lat))
      .attr("r", 5)
    .append("svg:title")
      .text(d=>d.stop_name);
}

init();

</script>
</body>